/*
  Sticker cards

  Layout:
  - art window near the top (sticker image lives here)
  - holo/glare effects are usually constrained to the art window,
    but `trainer gallery rare holo` should cover the entire card
  - metadata renders in the bottom section
*/

.card[data-set="stickers"] {
  /* Keep a consistent "safety margin" so elements don't hug the edges. */
  --sticker-safe: 5%;
  /*
    Sticker cards have large light areas; make the paper texture clearly visible.
    Use multiply so the darker speckles show up on near-white backgrounds.
  */
  --front-texture-opacity: 0.38;
  --front-texture-blend: multiply;
  /* We do NOT want a texture overlay on top of the card face for stickers. */
  --front-texture-opacity: 0;

  /*
    Sticker card face:
    - the face is an explicit background image (defaulting to the repo texture)
    - sizing is controlled here (no "overlay" layer above the UI)
  */
  --card-front-img: url("/img/card_front_texture.png");
  --card-front-position: center;
  --card-front-size: 100% 100%;
  --card-front-repeat: no-repeat;

  /*
    Sticker typography defaults (home page / normal cards).
    The inspect page overrides these via CSS variables so it can be larger without
    making all cards chunky.
  */
  font-size: 16px;
  --sticker-title-size: 1.2em;
  --sticker-date-size: 0.82em;
  --sticker-desc-size: 0.90em;
  --sticker-prints-size: 0.80em;
  --sticker-card-number-size: 0.90em;
  --sticker-meta-weight: 500;

  /* Art window geometry (percentages of the full card). */
  --sticker-header-top: var(--sticker-safe);
  --sticker-header-height: 6%;

  /* Bigger art window: the sticker should dominate the card. */
  --sticker-art-gap: 1.5%;
  --sticker-art-top: calc(var(--sticker-header-top) + var(--sticker-header-height) + var(--sticker-art-gap));
  --sticker-art-left: var(--sticker-safe);
  --sticker-art-right: var(--sticker-safe);
  /* Balance: larger sticker image, but still enough room for the info panel + footer. */
  --sticker-art-bottom: 26%;
  --sticker-art-radius: 2.75%;

  --sticker-footer-height: 5%;
  --sticker-footer-gap: 1%;
  --sticker-meta-gap: 2%;

  /* For sticker cards, effects should cover the entire art window element. */
  --clip: inset(0 0 0 0 round var(--sticker-art-radius));
  --clip-invert: var(--clip);
  --clip-stage: var(--clip);
  --clip-stage-invert: var(--clip);
  --clip-trainer: var(--clip);
}

/*
  Responsive typography (mobile):
  The card itself can (and should) scale to fit the viewport, but the *text* must
  stay readable. These overrides intentionally make type feel slightly "zoomed"
  on small screens to preserve hierarchy + legibility.
*/
@media (max-width: 520px) {
  .card[data-set="stickers"] {
    /* Bump base type to compensate for smaller card rendering on phones. */
    font-size: clamp(20px, 5.2vw, 22px);

    /* Preserve hierarchy: title > description > metadata. */
    --sticker-title-size: 1.34em;
    --sticker-date-size: 0.92em;
    --sticker-desc-size: 1.06em;
    --sticker-prints-size: 0.96em;
    --sticker-card-number-size: 1.06em;
    --sticker-meta-weight: 600;

    /* Rebalance layout so bigger type doesn't feel cramped. */
    --sticker-art-bottom: 30%;
    --sticker-footer-height: 6%;
    --sticker-meta-gap: 2.5%;
  }

  .card[data-set="stickers"][data-front-shape="square"] {
    --sticker-art-bottom: 28%;
  }

  .card[data-set="stickers"] .sticker__meta {
    gap: 8px;
  }
}

/*
  Extra-small phones (roughly iPhone SE / 280-390px wide):
  The card shrinks with the viewport, but we intentionally bump sticker type for readability.
  On very small widths the description can wrap and the bottom meta region runs out of space,
  which then gets clipped by the card face's overflow/border radius.
*/
@media (max-width: 420px) {
  .card[data-set="stickers"] {
    /* Give the meta area a little more room without dramatically shrinking the art window. */
    --sticker-safe: 4.5%;
    --sticker-art-bottom: 32%;
    --sticker-meta-gap: 2.25%;
    --sticker-footer-gap: 0.8%;
  }

  .card[data-set="stickers"][data-front-shape="square"] {
    --sticker-art-bottom: 30%;
    --sticker-meta-gap: 2%;
  }

  .card[data-set="stickers"] .sticker__meta {
    gap: 6px;
  }
}

@media (max-width: 340px) {
  /* On ultra-narrow screens, prevent the description from wrapping into clipped lines. */
  .card[data-set="stickers"] .sticker__desc {
    display: block;
    -webkit-line-clamp: initial;
    -webkit-box-orient: initial;
    white-space: nowrap;
    text-overflow: ellipsis;
  }
}

/* Mid-size devices (small tablets / narrow desktop): avoid "shrunk" typography. */
@media (min-width: 521px) and (max-width: 900px) {
  .card[data-set="stickers"] {
    font-size: clamp(18px, 2.4vw, 20px);

    --sticker-title-size: 1.26em;
    --sticker-date-size: 0.88em;
    --sticker-desc-size: 0.98em;
    --sticker-prints-size: 0.90em;
    --sticker-card-number-size: 0.98em;
    --sticker-meta-weight: 550;

    --sticker-art-bottom: 28%;
    --sticker-footer-height: 5.5%;
  }

  .card[data-set="stickers"][data-front-shape="square"] {
    --sticker-art-bottom: 26%;
  }
}

.card[data-set="stickers"][data-sticker-foil="full"] {
  /*
    Full-card foils:
    Many effect styles clip using the `--clip*` variables. For sticker cards the defaults
    are art-window-sized, so we override them to the full card border radius.
  */
  --clip: inset(0 0 0 0 round var(--card-radius));
  --clip-invert: var(--clip);
  --clip-stage: var(--clip);
  --clip-stage-invert: var(--clip);
  --clip-trainer: var(--clip);
  --clip-borders: var(--clip);
}

.card[data-set="stickers"][data-sticker-foil="full"] .card__shine {
  /* Ensure the foil layers sit above sticker UI/text (the "whole card surface" look). */
  z-index: 30;
}

.card[data-set="stickers"][data-sticker-foil="full"] .card__glare {
  z-index: 31;
}

.card[data-set="stickers"][data-front-shape="square"] {
  /* Reduce letterboxing for square sticker art (tighten the inner frame). */
  --sticker-art-bottom: 23%;
  --sticker-meta-gap: 1.75%;
}

.card[data-set="stickers"] .card__front {
  position: relative;
  overflow: hidden;
  /* A "trading card" face behind the sticker. */
  background-image: var(--card-front-img);
  background-position: var(--card-front-position);
  background-size: var(--card-front-size);
  background-repeat: var(--card-front-repeat);
  box-shadow:
    inset 0 0 0 2px rgba(0, 0, 0, 0.22),
    inset 0 0 0 1px rgba(255, 255, 255, 0.4);
}

/* Mystery placeholder: the image is the entire card face. */
.card[data-set="stickers"][data-variant="mystery"] .card__front {
  background: transparent;
}

.card[data-set="stickers"][data-variant="mystery"] .card__front::before {
  /* Disable the paper texture overlay so the mystery art is clean. */
  opacity: 0;
}

.card[data-set="stickers"][data-variant="mystery"] img.mystery__face {
  height: 100%;
  object-fit: cover;
  object-position: center;
}

/* "Mystery" placeholder card state */
.card[data-set="stickers"][data-hidden="true"] .card__front {
  filter: saturate(0.6) brightness(0.72) contrast(1.05);
}

.card[data-set="stickers"][data-hidden="true"] .card__front::after {
  content: "";
  position: absolute;
  inset: 0;
  z-index: 50;
  pointer-events: none;
  background:
    radial-gradient(circle at 30% 20%, rgba(0, 0, 0, 0.55), rgba(0, 0, 0, 0) 55%),
    radial-gradient(circle at 80% 85%, rgba(0, 0, 0, 0.55), rgba(0, 0, 0, 0) 60%),
    rgba(0, 0, 0, 0.25);
  mix-blend-mode: multiply;
}

.card[data-set="stickers"][data-hidden="true"] .sticker__title,
.card[data-set="stickers"][data-hidden="true"] .sticker__desc,
.card[data-set="stickers"][data-hidden="true"] .sticker__date,
.card[data-set="stickers"][data-hidden="true"] .sticker__prints,
.card[data-set="stickers"][data-hidden="true"] .sticker__rarity {
  opacity: 0.6;
}

/* The base styles apply very broad rules to *all* descendants of the rotator;
   for sticker layout we "reset" only our sticker subtrees. */
.card[data-set="stickers"] .sticker__bg,
.card[data-set="stickers"] .sticker__header,
.card[data-set="stickers"] .sticker__header *,
.card[data-set="stickers"] .sticker__art,
.card[data-set="stickers"] .sticker__art-bg,
.card[data-set="stickers"] .sticker__art-inner,
.card[data-set="stickers"] .sticker__face,
.card[data-set="stickers"] .sticker__frame,
.card[data-set="stickers"] .sticker__meta,
.card[data-set="stickers"] .sticker__meta *,
.card[data-set="stickers"] .sticker__footer,
.card[data-set="stickers"] .sticker__footer * {
  aspect-ratio: auto;
  grid-area: auto;
  border-radius: 0;
  overflow: visible;
}

.card[data-set="stickers"] .sticker__bg,
.card[data-set="stickers"] .sticker__header,
.card[data-set="stickers"] .sticker__art,
.card[data-set="stickers"] .sticker__art-bg,
.card[data-set="stickers"] .sticker__art-inner,
.card[data-set="stickers"] .sticker__frame,
.card[data-set="stickers"] .sticker__meta,
.card[data-set="stickers"] .sticker__footer {
  width: auto;
  height: auto;
}

.card[data-set="stickers"] .sticker__header {
  position: absolute;
  left: var(--sticker-safe);
  right: var(--sticker-safe);
  top: var(--sticker-header-top);
  height: var(--sticker-header-height);
  z-index: 12;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding-top: 0.25rem;
  color: rgba(5, 10, 12, 0.9);
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.55);
}

.card[data-set="stickers"] .sticker__title {
  font-family: var(--font-sans);
  font-weight: 700;
  font-stretch: 100%;
  font-optical-sizing: none;
  font-variation-settings: "opsz" var(--opsz-heading);
  letter-spacing: 0.02em;
  font-size: var(--sticker-title-size);
  line-height: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.card[data-set="stickers"] .sticker__bg {
  position: absolute;
  inset: 0;
  z-index: 0;
  background:
    radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.75), rgba(255, 255, 255, 0) 55%),
    radial-gradient(circle at 70% 80%, rgba(0, 0, 0, 0.06), rgba(0, 0, 0, 0) 60%);
}

.card[data-set="stickers"] .sticker__art {
  position: absolute;
  inset: var(--sticker-art-top) var(--sticker-art-right) var(--sticker-art-bottom)
    var(--sticker-art-left);
  z-index: 2;
  border-radius: var(--sticker-art-radius);
  overflow: hidden;
  /* Make the art window feel "pressed" into the card surface. */
  box-shadow:
    inset 0 0 0 1px rgba(0, 0, 0, 0.20),
    inset 0 2px 0 rgba(255, 255, 255, 0.60),
    inset 0 -16px 28px rgba(0, 0, 0, 0.26),
    inset 0 14px 22px rgba(255, 255, 255, 0.16);
}

.card[data-set="stickers"] .sticker__art-bg {
  position: absolute;
  inset: 0;
  z-index: 0;
  background: rgba(255, 255, 255, 0.96);
  box-shadow:
    inset 0 0 0 1px rgba(0, 0, 0, 0.10),
    0 10px 26px rgba(0, 0, 0, 0.20);
}

.card[data-set="stickers"] .sticker__art-bg::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  /* A subtle bevel gradient to sell the "stamped" depth. */
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.70) 0%,
    rgba(255, 255, 255, 0.0) 30%,
    rgba(0, 0, 0, 0.34) 100%
  );
  mix-blend-mode: multiply;
  opacity: 0.40;
}

.card[data-set="stickers"] .sticker__art-bg::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background-image: var(--front-texture);
  background-position: var(--front-texture-position);
  background-size: var(--front-texture-size);
  background-repeat: var(--front-texture-repeat);
  opacity: 0.24;
  mix-blend-mode: var(--front-texture-blend);
}

.card[data-set="stickers"] .sticker__art-inner {
  position: absolute;
  inset: 0;
  z-index: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  box-sizing: border-box;
  isolation: isolate;
}

.card[data-set="stickers"] .sticker__art-inner::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  /* Inner shadow across the sticker image itself to match the card edge treatment. */
  box-shadow:
    inset 0 0 0 1px rgba(0, 0, 0, 0.22),
    inset 0 0 0 2px rgba(255, 255, 255, 0.12),
    inset 0 18px 26px rgba(255, 255, 255, 0.12),
    inset 0 -22px 36px rgba(0, 0, 0, 0.30);
  z-index: 2;
}

.card[data-set="stickers"] .sticker__face {
  width: 100%;
  height: 100%;
  display: block;
  object-fit: contain;
  object-position: center center;
  /* Less "floating", more "pressed in". */
  filter: drop-shadow(0 10px 16px rgba(0, 0, 0, 0.18));
  z-index: 1;
}

.card[data-set="stickers"] .sticker__frame {
  position: absolute;
  inset: 0;
  z-index: 6;
  border-radius: var(--sticker-art-radius);
  box-shadow:
    inset 0 0 0 2px rgba(0, 0, 0, 0.24),
    inset 0 1px 0 rgba(255, 255, 255, 0.55),
    inset 0 -1px 0 rgba(0, 0, 0, 0.12);
  pointer-events: none;
}

/* FULL CARD FOIL (Trainer Gallery Rare Holo) */
.card[data-set="stickers"][data-sticker-foil="full"] .card__front > .card__shine,
.card[data-set="stickers"][data-sticker-foil="full"] .card__front > .card__glare {
  position: absolute;
  inset: 0;
}

.card[data-set="stickers"][data-sticker-foil="full"] .card__front > .card__shine {
  z-index: 7;
}

.card[data-set="stickers"][data-sticker-foil="full"] .card__front > .card__glare {
  z-index: 8;
}

/* Ensure the effect layers fill the art window and stay on top of the sticker image. */
.card[data-set="stickers"] .sticker__art > .card__shine,
.card[data-set="stickers"] .sticker__art > .card__glare {
  position: absolute;
  inset: 0;
}

.card[data-set="stickers"] .sticker__art > .card__shine {
  z-index: 4;
}

.card[data-set="stickers"] .sticker__art > .card__glare {
  z-index: 5;
}

/* Bottom metadata area */
.card[data-set="stickers"] .sticker__meta {
  position: absolute;
  left: var(--sticker-safe);
  right: var(--sticker-safe);
  top: calc(100% - var(--sticker-art-bottom) + var(--sticker-meta-gap));
  bottom: calc(var(--sticker-safe) + var(--sticker-footer-height) + var(--sticker-footer-gap));
  z-index: 10;
  display: flex;
  flex-direction: column;
  gap: 6px;
  padding: 0;
  border-radius: 0;
  overflow: visible;
  background: transparent;
  box-shadow: none;
  font-family: var(--font-sans);
  font-weight: var(--sticker-meta-weight);
  font-stretch: 100%;
  font-optical-sizing: none;
  font-variation-settings: "opsz" var(--opsz-body);
  color: rgba(5, 10, 12, 0.88);
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.55);
}

.card[data-set="stickers"][data-sticker-foil="full"] .sticker__meta {
  /* Keep readable on top of full-card foil without adding a box. */
  text-shadow:
    0 1px 0 rgba(255, 255, 255, 0.7),
    0 2px 12px rgba(0, 0, 0, 0.10);
}

.card[data-set="stickers"] .sticker__date,
.card[data-set="stickers"] .sticker__desc,
.card[data-set="stickers"] .sticker__prints,
.card[data-set="stickers"] .sticker__card-number {
  display: block;
}

.card[data-set="stickers"] .sticker__date {
  font-family: var(--font-sans);
  font-weight: var(--sticker-meta-weight);
  font-stretch: 100%;
  font-optical-sizing: none;
  font-variation-settings: "opsz" var(--opsz-body);
  font-size: var(--sticker-date-size);
  line-height: 1.15;
  letter-spacing: 0.04em;
  opacity: 0.85;
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  /* Prevent descenders from getting clipped by subpixel rounding at small sizes. */
  padding-bottom: 0.08em;
  align-self: center;
}

.card[data-set="stickers"] .sticker__desc {
  font-family: var(--font-sans);
  font-weight: var(--sticker-meta-weight);
  font-stretch: 100%;
  font-optical-sizing: none;
  font-variation-settings: "opsz" var(--opsz-body);
  font-size: var(--sticker-desc-size);
  line-height: 1.22;
  opacity: 0.92;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  /* Same deal: small extra padding avoids clipped glyph descenders on narrow screens. */
  padding-bottom: 0.10em;
}

.card[data-set="stickers"] .sticker__footer {
  position: absolute;
  left: var(--sticker-safe);
  right: var(--sticker-safe);
  bottom: var(--sticker-safe);
  height: var(--sticker-footer-height);
  z-index: 12;
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 10px;
  font-family: var(--font-sans);
  font-weight: var(--sticker-meta-weight);
  font-stretch: 100%;
  font-optical-sizing: none;
  font-variation-settings: "opsz" var(--opsz-body);
  color: rgba(5, 10, 12, 0.85);
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.55);
}

.card[data-set="stickers"] .sticker__prints {
  font-family: var(--font-sans);
  font-weight: var(--sticker-meta-weight);
  font-stretch: 100%;
  font-optical-sizing: none;
  font-variation-settings: "opsz" var(--opsz-body);
  font-size: var(--sticker-prints-size);
  opacity: 0.88;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.card[data-set="stickers"] .sticker__card-number {
  font-family: var(--font-sans);
  font-weight: 700;
  font-stretch: 100%;
  font-optical-sizing: none;
  font-variation-settings: "opsz" var(--opsz-mid);
  font-size: var(--sticker-card-number-size);
  letter-spacing: 0.04em;
  opacity: 0.9;
  white-space: nowrap;
}
